# -*- mode: snippet -*-
# name: mergable_range_set_def
# key: mergable_range_set_def
# --
template <typename T>
struct MergableRangeSet{
  using PT = pair<T, T>;
  set<PT> st;
  T maxi = numeric_limits<T>::max();
  MergableRangeSet(){}
  // [l, r)
  void add(T l, T r){
    if(r <= l)return;
    auto itr = st.upper_bound(make_pair(l, 0));
    if(itr != st.begin()){
      auto litr = itr;
      --litr;
      if(litr->second >= r){
        return;
      }else if(litr->second >= l){
        l = litr->first;
        st.erase(litr);
      }
    }
    if(itr != st.end()){
      if(r < itr->first)st.insert(make_pair(l, r));
      else {
        PT p = make_pair(l, max(r, itr->second));
        st.erase(itr);
        st.insert(p);
      }
    }else{
      st.insert(make_pair(l, r));
    }
  }
  typename set<PT>::iterator begin() noexcept{
    return st.begin();
  }
  typename set<PT>::iterator end() noexcept{
    return st.end();
  }
  size_t size(){
    return st.size();
  }
};
